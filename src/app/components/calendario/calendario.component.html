<!-- Header con informaciÃ³n de usuario -->
<div class="app-header">
  <div class="header-content">
    <div class="header-left">
      <h1>ğŸ‚ Calendario de CumpleaÃ±os</h1>
      <p>Hotel HB - Sistema de GestiÃ³n</p>
    </div>
    
    <div class="header-right">
      <div class="user-info">
        <span class="user-icon">ğŸ‘¤</span>
        <div class="user-details">
          <span class="user-name">{{ authService.getNombreUsuario() }}</span>
          <span class="user-role">{{ authService.getRolActual() }}</span>
        </div>
      </div>
      <button class="btn btn-logout btn-light" (click)="cerrarSesion()">
        ğŸšª Cerrar SesiÃ³n
      </button>
    </div>
  </div>
</div>

<div class="calendario-container">
  <div class="calendario-header">
    <button 
      class="btn btn-nav btn-primary" 
      (click)="mesAnterior()"
      [disabled]="!puedeRetroceder()">
      <span>â† Anterior</span>
    </button>
    
    <div class="mes-anio">
      <h2>
        <span class="emoji-calendar" (click)="activarModoEditor()" title="Click para activar modo editor">ğŸ“…</span>
        {{ nombresMeses[mesActual] }} {{ anioActual }}
      </h2>
    </div>
    
    <button class="btn btn-nav btn-primary" (click)="mesSiguiente()">
      <span>Siguiente â†’</span>
    </button>
  </div>

  <div class="dias-semana">
    <div class="dia-semana" *ngFor="let dia of diasSemana">{{ dia }}</div>
  </div>

  <div class="dias-grid">
    <div 
      *ngFor="let dia of diasCalendario"
      class="dia-celda"
      [class.mes-actual]="dia.esMesActual"
      [class.hoy]="dia.esHoy"
      [class.tiene-cumpleanos]="dia.tieneCumpleanos"
      (click)="abrirModalDia(dia)">
      
      <span class="numero-dia">{{ dia.dia }}</span>
      
      <div class="indicador-cumpleanos" *ngIf="dia.tieneCumpleanos">
        <span class="badge badge-warning">ğŸ‚ {{ dia.cumpleanos.length }}</span>
      </div>

      <div class="nombres-preview" *ngIf="dia.tieneCumpleanos && dia.cumpleanos.length > 0">
        <span class="nombre-corto">{{ dia.cumpleanos[0].cliente.nombre }}</span>
        <span *ngIf="dia.cumpleanos.length > 1" class="mas">+{{ dia.cumpleanos.length - 1 }}</span>
      </div>
    </div>
  </div>

  <button class="btn btn-agregar btn-success btn-lg" (click)="abrirFormulario()">
    <span class="btn-icon">â•</span> Agregar Nuevo Cliente
  </button>

  <!-- Banner de cumpleaÃ±os de hoy -->
  <div class="cumpleanos-hoy-simple" *ngIf="totalCumpleanosHoy > 0">
    <div class="simple-content">
      <div class="simple-left">
        <span class="simple-icon">ğŸ‰</span>
        <div class="simple-text">
          <h3>Â¡CumpleaÃ±os de Hoy!</h3>
          <p>Hay {{ totalCumpleanosHoy }} {{ totalCumpleanosHoy === 1 ? 'persona cumpliendo aÃ±os' : 'personas cumpliendo aÃ±os' }}</p>
        </div>
      </div>
      <button class="btn btn-primary" (click)="abrirModalCumpleanosHoy()">
        Ver Detalles â†’
      </button>
    </div>
  </div>

  <!-- Barra de estadÃ­sticas -->
  <div class="stats-bar">
    <div class="stat-card">
      <span class="stat-icon">ğŸ‘¥</span>
      <div class="stat-info">
        <span class="stat-value">{{ clienteService.getClientesFiltrados().length }}</span>
        <span class="stat-label">Clientes registrados</span>
      </div>
    </div>
    
    <div class="stat-card stat-editor" *ngIf="modoEditor">
      <span class="stat-icon">âœï¸</span>
      <div class="stat-info">
        <span class="stat-value">EDITOR</span>
        <span class="stat-label">Modo ediciÃ³n activo</span>
      </div>
      <button class="btn-desactivar-editor" (click)="desactivarModoEditor()" title="Cerrar modo editor">
        âœ–
      </button>
    </div>
    
    <div class="stat-card" *ngIf="authService.isAdmin()">
      <span class="stat-icon">ğŸ”§</span>
      <div class="stat-info">
        <span class="stat-value">ADMIN</span>
        <span class="stat-label">Administrador</span>
      </div>
    </div>
  </div>
</div>

<!-- MODAL 1: Ãreas del dÃ­a seleccionado -->
<div class="modal-overlay modal-nivel-1" *ngIf="modalDiaAbierto" (click)="cerrarModalDia()">
  <div class="modal-content modal-areas fade-in" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>ğŸ‰ CumpleaÃ±os del {{ diaSeleccionado?.dia }} de {{ nombresMeses[mesActual] }} {{ anioActual }}</h3>
      <button class="btn-cerrar" (click)="cerrarModalDia()">Ã—</button>
    </div>

    <div class="modal-body">
      <div class="areas-grid">
        <div class="area-card" *ngFor="let area of obtenerAreas()">
          <div class="area-card-header">
            <div class="area-icon-wrapper">
              <span class="area-emoji">
                {{ area === 'Administrador' ? 'ğŸ‘”' : 
                   area === 'Karina' ? 'ğŸ‘©' : 
                   area === 'Elisa' ? 'ğŸ‘©â€ğŸ¦°' : 
                   area === 'Cesia' ? 'ğŸ‘©â€ğŸ¦±' : 
                   area === 'Restaurante' ? 'ğŸ½ï¸' : 
                   area === 'RecepciÃ³n' ? 'ğŸ¨' : 'ğŸ‘¥' }}
              </span>
            </div>
            <div class="area-info">
              <h4>{{ area }}</h4>
              <p class="area-count">{{ cumpleanosPorArea[area].length }} cumpleaÃ±os</p>
            </div>
          </div>
          
          <button class="btn-ver-detalles" (click)="abrirModalClientesArea(area)">
            Ver Clientes â†’
          </button>
        </div>
      </div>

      <div *ngIf="obtenerAreas().length === 0" class="sin-cumpleanos">
        <span class="emoji-grande">ğŸ“…</span>
        <p>No hay cumpleaÃ±os registrados para este dÃ­a</p>
      </div>
    </div>
  </div>
</div>

<!-- MODAL 2: Clientes del Ã¡rea seleccionada -->
<div class="modal-overlay modal-nivel-2" *ngIf="modalClientesAreaAbierto" (click)="cerrarModalClientesArea()">
  <div class="modal-content modal-clientes-area fade-in" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>ğŸ‘¥ {{ areaSeleccionada }} - Lista de CumpleaÃ±eros</h3>
      <button class="btn-cerrar" (click)="cerrarModalClientesArea()">Ã—</button>
    </div>

    <div class="modal-body">
      <div class="clientes-grid">
        <div class="cliente-mini-card" *ngFor="let item of obtenerClientesDeArea(areaSeleccionada!)">
          <div class="cliente-mini-avatar">
            {{ item.cliente.nombre.charAt(0) }}{{ item.cliente.apellidoPaterno.charAt(0) }}
          </div>
          
          <div class="cliente-mini-info">
            <h4>{{ item.cliente.nombre }} {{ item.cliente.apellidoPaterno }}</h4>
            <p class="cliente-mini-edad">ğŸ‚ Cumple {{ item.edad }} aÃ±os</p>
          </div>

          <button class="btn-ver-cumpleanero" (click)="abrirModalDetalleCumpleanero(item.cliente)">
            Ver Perfil â†’
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- MODAL 3: Detalle del cumpleaÃ±ero -->
<div class="modal-overlay modal-nivel-3" *ngIf="modalDetalleCumpleaneroAbierto" (click)="cerrarModalDetalleCumpleanero()">
  <div class="modal-content modal-cumpleanero fade-in" (click)="$event.stopPropagation()">
    <div class="modal-header-cumpleanero">
      <div class="header-cumpleanero-content">
        <div class="avatar-cumpleanero-grande">
          {{ clienteDetalle?.nombre?.charAt(0) }}{{ clienteDetalle?.apellidoPaterno?.charAt(0) }}
        </div>
        <div class="titulo-cumpleanero">
          <h3>{{ clienteDetalle?.nombre }} {{ clienteDetalle?.apellidoPaterno }}</h3>
          <p>{{ clienteDetalle?.apellidoMaterno }}</p>
        </div>
      </div>
      <button class="btn-cerrar" (click)="cerrarModalDetalleCumpleanero()">Ã—</button>
    </div>

    <div class="modal-body-cumpleanero" *ngIf="clienteDetalle">
      <!-- InformaciÃ³n principal -->
      <div class="info-principal">
        <div class="info-item">
          <span class="info-icon">ğŸ‚</span>
          <div class="info-content">
            <span class="info-label">Edad</span>
            <span class="info-value">{{ obtenerEdad(clienteDetalle.fechaNacimiento) }} aÃ±os</span>
          </div>
        </div>

        <div class="info-item">
          <span class="info-icon">ğŸ“…</span>
          <div class="info-content">
            <span class="info-label">Fecha de Nacimiento</span>
            <span class="info-value">{{ formatearFecha(clienteDetalle.fechaNacimiento) }}</span>
          </div>
        </div>

        <div class="info-item" *ngIf="clienteDetalle.telefono">
          <span class="info-icon">ğŸ“±</span>
          <div class="info-content">
            <span class="info-label">TelÃ©fono</span>
            <span class="info-value">{{ formatearTelefono(clienteDetalle.telefono) }}</span>
          </div>
        </div>

        <div class="info-item">
          <span class="info-icon">ğŸ‘¤</span>
          <div class="info-content">
            <span class="info-label">Registrado por</span>
            <span class="info-value">{{ obtenerNombreRol(clienteDetalle.creadoPor) }}</span>
          </div>
        </div>
      </div>

    <!-- DescripciÃ³n -->
    <div class="descripcion-cumpleanero" *ngIf="clienteDetalle.descripcion">
    <h4>ğŸ“ Notas sobre {{ clienteDetalle.nombre }}</h4>
    <p>{{ clienteDetalle.descripcion }}</p>
    </div>

    <!-- Si NO tiene descripciÃ³n, mostrar mensaje -->
    <div class="descripcion-cumpleanero sin-descripcion" *ngIf="!clienteDetalle.descripcion">
    <h4>ğŸ“ Notas</h4>
    <p class="text-muted">Sin informaciÃ³n adicional registrada</p>
    </div>

      <!-- BotÃ³n de WhatsApp -->
      <div class="whatsapp-cumpleanero" *ngIf="clienteDetalle.telefono">
        <button class="btn-whatsapp-grande" (click)="enviarWhatsApp(clienteDetalle)">
          <span class="whatsapp-icon-grande">ğŸ’¬</span>
          <div class="whatsapp-texto">
            <span class="whatsapp-titulo">Enviar FelicitaciÃ³n</span>
            <span class="whatsapp-subtitulo">Mensaje personalizado por WhatsApp</span>
          </div>
        </button>
      </div>

      <!-- Botones de ediciÃ³n (solo modo editor) -->
      <div class="acciones-cumpleanero" *ngIf="modoEditor">
        <button class="btn btn-info btn-lg" (click)="editarCliente(clienteDetalle)">
          âœï¸ Editar
        </button>
        <button class="btn btn-danger btn-lg" (click)="eliminarCliente(clienteDetalle.id)">
          ğŸ—‘ï¸ Eliminar
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Modal de cumpleaÃ±os de HOY (usa misma lÃ³gica de 3 niveles) -->
<div class="modal-overlay modal-nivel-1" *ngIf="modalCumpleanosHoyAbierto" (click)="cerrarModalCumpleanosHoy()">
  <div class="modal-content modal-areas fade-in" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>ğŸ‰ CumpleaÃ±os de Hoy</h3>
      <button class="btn-cerrar" (click)="cerrarModalCumpleanosHoy()">Ã—</button>
    </div>

    <div class="modal-body">
      <div class="areas-grid">
        <div class="area-card" *ngFor="let area of obtenerAreasHoy()">
          <div class="area-card-header">
            <div class="area-icon-wrapper">
              <span class="area-emoji">
                {{ area === 'Administrador' ? 'ğŸ‘”' : 
                   area === 'Karina' ? 'ğŸ‘©' : 
                   area === 'Elisa' ? 'ğŸ‘©â€ğŸ¦°' : 
                   area === 'Ceia' ? 'ğŸ‘©â€ğŸ¦±' : 
                   area === 'Restaurante' ? 'ğŸ½ï¸' : 
                   area === 'RecepciÃ³n' ? 'ğŸ¨' : 'ğŸ‘¥' }}
              </span>
            </div>
            <div class="area-info">
              <h4>{{ area }}</h4>
              <p class="area-count">{{ cumpleanosHoy[area].length }} cumpleaÃ±os</p>
            </div>
          </div>
          
          <button class="btn-ver-detalles" (click)="cerrarModalCumpleanosHoy(); cumpleanosPorArea = cumpleanosHoy; areaSeleccionada = area; modalClientesAreaAbierto = true;">
            Ver Clientes â†’
          </button>
        </div>
      </div>

      <div *ngIf="obtenerAreasHoy().length === 0" class="sin-cumpleanos">
        <span class="emoji-grande">ğŸ“…</span>
        <p>No hay cumpleaÃ±os hoy</p>
      </div>
    </div>
  </div>
</div>

<!-- Modal de formulario -->
<div class="modal-overlay modal-nivel-4" *ngIf="formularioAbierto" (click)="cerrarFormulario()">
  <div class="modal-content modal-formulario fade-in" (click)="$event.stopPropagation()">
    <app-agregar-cliente 
      [clienteEditar]="clienteEditando"
      (clienteGuardado)="onClienteGuardado()"
      (cancelar)="cerrarFormulario()">
    </app-agregar-cliente>
  </div>
</div>