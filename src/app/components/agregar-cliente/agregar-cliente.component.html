<div class="formulario-container">
  <div class="formulario-header">
    <h3>{{ clienteEditar ? 'Editar Cliente' : 'Agregar Nuevo Cliente' }}</h3>
  </div>

  <form [formGroup]="formulario" (ngSubmit)="guardar()">
    <div class="form-row">
      <div class="form-group">
        <label for="nombre">Nombre *</label>
        <input 
          type="text" 
          id="nombre"
          formControlName="nombre"
          placeholder="Ej: Juan"
          [class.error]="formulario.get('nombre')?.invalid && formulario.get('nombre')?.touched">
        <span class="error-message" *ngIf="formulario.get('nombre')?.invalid && formulario.get('nombre')?.touched">
          El nombre es requerido (mÃ­nimo 2 caracteres)
        </span>
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="apellidoPaterno">Apellido Paterno *</label>
        <input 
          type="text" 
          id="apellidoPaterno"
          formControlName="apellidoPaterno"
          placeholder="Ej: PÃ©rez"
          [class.error]="formulario.get('apellidoPaterno')?.invalid && formulario.get('apellidoPaterno')?.touched">
        <span class="error-message" *ngIf="formulario.get('apellidoPaterno')?.invalid && formulario.get('apellidoPaterno')?.touched">
          El apellido paterno es requerido (mÃ­nimo 2 caracteres)
        </span>
      </div>

      <div class="form-group">
        <label for="apellidoMaterno">Apellido Materno</label>
        <input 
          type="text" 
          id="apellidoMaterno"
          formControlName="apellidoMaterno"
          placeholder="Ej: GarcÃ­a">
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="fechaNacimiento">Fecha de Nacimiento *</label>
        <input 
          type="date" 
          id="fechaNacimiento"
          formControlName="fechaNacimiento"
          [class.error]="formulario.get('fechaNacimiento')?.invalid && formulario.get('fechaNacimiento')?.touched">
        <span class="error-message" *ngIf="formulario.get('fechaNacimiento')?.invalid && formulario.get('fechaNacimiento')?.touched">
          La fecha de nacimiento es requerida
        </span>
        
        <div class="edad-calculada" *ngIf="edadCalculada !== null">
          <span>ğŸ‚ Edad actual: <strong>{{ edadCalculada }} aÃ±os</strong></span>
        </div>
      </div>

      <div class="form-group">
        <label for="telefono">ğŸ“± TelÃ©fono (10 dÃ­gitos) *</label>
        <input 
          type="tel" 
          id="telefono"
          formControlName="telefono"
          placeholder="Ej: 2281234567"
          maxlength="10"
          (input)="formatearTelefonoInput($event)"
          [class.error]="formulario.get('telefono')?.invalid && formulario.get('telefono')?.touched">
        <span class="error-message" *ngIf="formulario.get('telefono')?.invalid && formulario.get('telefono')?.touched">
          <span *ngIf="formulario.get('telefono')?.errors?.['required']">El telÃ©fono es requerido</span>
          <span *ngIf="formulario.get('telefono')?.errors?.['pattern']">Debe ser un nÃºmero de 10 dÃ­gitos</span>
        </span>
        <span class="helper-text" *ngIf="formulario.get('telefono')?.valid && formulario.get('telefono')?.value">
          âœ… TelÃ©fono vÃ¡lido para WhatsApp
        </span>
      </div>
    </div>

    <!-- NUEVO: Campo Empresa -->
    <div class="form-group">
      <label for="empresa">ğŸ¢ Empresa / CompaÃ±Ã­a</label>
      <input 
        type="text" 
        id="empresa"
        formControlName="empresa"
        placeholder="Ej: Coca-Cola, PEMEX, Google, etc.">
      <span class="helper-text">ğŸ’¡ Opcional - Registra de quÃ© empresa proviene el cliente</span>
    </div>

    <!-- Selector de quiÃ©n registra (solo admin) -->
    <div class="form-group" *ngIf="esAdmin">
      <label for="registradoPor">ğŸ¢ Registrado por (Opcional - Solo Admin)</label>
      <select 
        id="registradoPor"
        formControlName="registradoPor"
        class="form-select">
        <option value="">-- Yo (Administrador) --</option>
        <option value="karina">Karina</option>
        <option value="elisa">Elisa</option>
        <option value="cesia">Cesia</option>
        <option value="restaurante">Restaurante</option>
        <option value="recepcion">RecepciÃ³n</option>
      </select>
      <span class="helper-text">ğŸ’¡ Si no seleccionas nada, quedarÃ¡ registrado como Administrador</span>
    </div>

    <div class="form-group">
      <label for="descripcion">DescripciÃ³n / Notas</label>
      <textarea 
        id="descripcion"
        formControlName="descripcion"
        rows="4"
        placeholder="Ej: Cliente frecuente, le gusta el cafÃ© americano, cumpleaÃ±os importante..."></textarea>
      <span class="contador-caracteres">
        {{ formulario.get('descripcion')?.value?.length || 0 }} / 500 caracteres
      </span>
    </div>

    <div class="form-actions">
      <button type="button" class="btn-cancelar" (click)="cancelarFormulario()">
        Cancelar
      </button>
      <button 
        type="submit" 
        class="btn-guardar"
        [disabled]="formulario.invalid || guardando">
        <span *ngIf="!guardando">{{ clienteEditar ? 'âœï¸ Actualizar' : 'ğŸ’¾ Guardar' }}</span>
        <span *ngIf="guardando">â³ Guardando...</span>
      </button>
    </div>
  </form>
</div>